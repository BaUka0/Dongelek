from django.core.management.base import BaseCommand
from chatbot.models import ChatbotIntent

class Command(BaseCommand):
    help = 'Заполняет начальные намерения и ответы чат-бота'
    
    def handle(self, *args, **options):
        # Определите начальные намерения
        intents_data = [
            {
                'name': 'car_search',
                'description': 'Помощь в поиске автомобилей',
                'pattern': 'как искать автомобили, найти автомобиль, поиск авто, ищу машину, найти машину',
                'response': 'Вы можете искать автомобили, используя наши фильтры поиска на главной странице. Вы можете фильтровать по марке, модели, году, цене и другим параметрам!'
            },
            {
                'name': 'sell_car',
                'description': 'Информация о продаже автомобиля',
                'pattern': 'как продать машину, продать автомобиль, продажа авто, разместить объявление, размещение авто',
                'response': 'Чтобы продать автомобиль, вам нужно создать аккаунт и нажать кнопку "Продать автомобиль". Вам потребуется указать детали и загрузить фотографии автомобиля.'
            },
            {
                'name': 'account_creation',
                'description': 'Помощь с созданием аккаунта',
                'pattern': 'создать аккаунт, регистрация, зарегистрироваться, новый аккаунт, создать учетную запись',
                'response': 'Чтобы создать аккаунт, нажмите на ссылку "Регистрация" в верхнем меню и заполните форму регистрации своими данными.'
            },
            {
                'name': 'login_help',
                'description': 'Помощь со входом в аккаунт',
                'pattern': 'как войти, вход, не могу войти, проблемы с входом, забыл пароль',
                'response': 'Чтобы войти, нажмите на ссылку "Вход" в верхнем меню. Если вы забыли пароль, используйте ссылку "Забыли пароль" на странице входа.'
            },
            {
                'name': 'contact_seller',
                'description': 'Помощь с контактом продавцов',
                'pattern': 'связаться с продавцом, написать продавцу, поговорить с продавцом, задать вопрос продавцу',
                'response': 'Вы можете связаться с продавцом, нажав кнопку "Связаться с продавцом" на странице автомобиля. Для отправки сообщений необходимо войти в аккаунт.'
            },
            {
                'name': 'compare_cars',
                'description': 'Помощь с сравнением автомобилей',
                'pattern': 'сравнить автомобили, сравнение авто, как сравнить',
                'response': 'Вы можете добавить автомобили в список для сравнения, нажав кнопку "Сравнить" на любом объявлении. Затем откройте список сравнения, нажав "Сравнить" в верхнем меню.'
            },
            {
                'name': 'pricing',
                'description': 'Информация о ценах на автомобили',
                'pattern': 'цены на авто, стоимость, сколько стоит, диапазон цен, средняя цена',
                'response': 'Цены на автомобили на нашей платформе зависят от марки, модели, года выпуска, состояния и характеристик. Вы можете использовать фильтры, чтобы найти автомобили в вашем бюджете.'
            },
            {
                'name': 'favorites',
                'description': 'Помощь с функцией избранного',
                'pattern': 'избранное, сохранить авто, закладки, избранные автомобили',
                'response': 'Вы можете добавить автомобили в избранное, нажав на значок сердца в любом объявлении. Просмотреть избранное можно, нажав "Избранное" в верхнем меню.'
            },
            {
                'name': 'about_site',
                'description': 'Информация о сайте',
                'pattern': 'о dongelek, о сайте, что такое dongelek, информация о компании',
                'response': 'Dongelek — крупнейшая автомобильная площадка в Казахстане, соединяющая покупателей и продавцов автомобилей. Мы предлагаем безопасную платформу с проверенными объявлениями и отзывами пользователей.'
            },
            {
                'name': 'car_maintenance',
                'description': 'Информация о техническом обслуживании автомобилей',
                'pattern': 'техническое обслуживание, сервис авто, обслуживание машины, замена масла',
                'response': 'Регулярное техническое обслуживание важно для поддержания автомобиля в хорошем состоянии. Мы рекомендуем следовать графику обслуживания, указанному в руководстве вашего автомобиля. Для подержанных авто полезно проверить историю обслуживания перед покупкой.'
            },
            {
                'name': 'fuel_efficiency',
                'description': 'Информация об экономии топлива',
                'pattern': 'экономия топлива, расход топлива, экономичный автомобиль, гибрид, электромобиль',
                'response': 'Экономия топлива зависит от модели автомобиля и типа двигателя. На Dongelek вы можете фильтровать автомобили по типу топлива, включая гибриды и электромобили. Также вы можете проверить расход топлива в описании автомобиля.'
            },
            {
                'name': 'car_insurance',
                'description': 'Информация о страховании автомобилей',
                'pattern': 'страхование авто, страховка, застраховать машину, автострахование',
                'response': 'В Казахстане страхование автомобиля обязательно. Основной вид страхования — ОСАГО (Обязательное страхование гражданской ответственности владельцев транспортных средств). При покупке автомобиля оформите страховку до начала эксплуатации. Некоторые продавцы могут предложить передать действующую страховку.'
            },
            {
                'name': 'ev_cars',
                'description': 'Информация об электромобилях',
                'pattern': 'электромобиль, ev, электрокар, tesla, зарядка',
                'response': 'На Dongelek представлены электромобили от таких брендов, как Tesla, Nissan и других. При покупке электромобиля в Казахстане учитывайте инфраструктуру зарядных станций в вашем регионе. Вы можете отфильтровать электромобили на странице поиска.'
            },
            {
                'name': 'car_financing',
                'description': 'Информация о финансировании автомобилей',
                'pattern': 'автокредит, финансирование авто, рассрочка, кредит на авто, купить авто в рассрочку',
                'response': 'Многие автомобили на Dongelek можно приобрести в кредит. Вы можете оформить автокредит в большинстве банков Казахстана, а некоторые продавцы предлагают внутренние варианты финансирования. Уточните текущие ставки и условия в вашем банке.'
            },
            {
                'name': 'safety_ratings',
                'description': 'Информация о безопасности автомобилей',
                'pattern': 'безопасность авто, рейтинг безопасности, безопасный автомобиль, краш-тест',
                'response': 'Безопасность автомобиля — важный фактор. Хотя Dongelek не отображает официальные рейтинги безопасности, вы можете найти информацию о моделях на международных сайтах, таких как Euro NCAP. Новые автомобили обычно оснащены более современными системами безопасности.'
            },
            {
                'name': 'popular_brands',
                'description': 'Информация о популярных брендах автомобилей',
                'pattern': 'популярные бренды, лучшие бренды, марки авто, надежные бренды',
                'response': 'Популярные бренды автомобилей в Казахстане включают Toyota, Hyundai, Kia, Volkswagen и Lexus. Эти бренды известны своей надежностью и хорошей сетью обслуживания. Вы можете просмотреть все доступные бренды, используя наши фильтры поиска.'
            }
        ]
        
        created_count = 0
        updated_count = 0
        
        for intent_data in intents_data:
            intent, created = ChatbotIntent.objects.update_or_create(
                name=intent_data['name'],
                defaults={
                    'description': intent_data['description'],
                    'pattern': intent_data['pattern'],
                    'response': intent_data['response']
                }
            )
            
            if created:
                created_count += 1
            else:
                updated_count += 1
        
        self.stdout.write(self.style.SUCCESS(f'Успешно создано {created_count} новых намерений и обновлено {updated_count} существующих намерений.'))
